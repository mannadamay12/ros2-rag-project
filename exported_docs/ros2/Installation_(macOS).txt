Title: Installation (macOS)
URL: https://docs.ros.org/en/jazzy/Tutorials/Advanced/Simulators/Webots/Installation-MacOS.html
Section: Installation
--------------------------------------------------------------------------------

Installation (macOS)Goal:Install thewebots_ros2package and run simulation examples on macOS.Tutorial level:AdvancedTime:10 minutesContentsBackgroundPrerequisitesTasks1 Create the VM image2 Configure the VM3 Installwebots_ros24 Launch thewebots_ros2_universal_robotexampleBackgroundThewebots_ros2package provides an interface between ROS 2 and Webots.
It includes several sub-packages, includingwebots_ros2_driver, which allows you to start Webots and communicate with it.
Other sub-packages are mainly examples that show multiple possible implementations using the interface.
In this tutorial, you are going to install the package and learn how to run one of these examples.PrerequisitesIt is recommended to understand basic ROS principles covered in the beginnerTutorials.
In particular,Creating a workspaceandCreating a packageare useful prerequisites.It is necessary to install Webots natively on the mac in order to use thewebots_ros2package in the virtual machine as explained below.
You can follow theinstallation procedureorbuild it from sources.TasksOn macOS, a solution based on UTM virtual machines provides an improved user experience with ROS 2 compared to native macOS installation, as it runs ROS in a Linux environment.
However, Webots should be installed natively on macOS and it will be able to communicate with the ROS nodes running in the Virtual Machine (VM).
This solution allows for native 3D hardware acceleration for Webots.
The VM runs all the ROS part (including RViz) and connects to the host machine through TCP to start Webots.
A shared folder allows the script to transfer the world and other resource files from the VM to macOS where Webots is running.The following steps explain how to create the VM image with the installation of thewebots_ros2released package.
It is also possible to install it from sources.1 Create the VM imageInstall UTM on your macOS machine.
The link can be found on theofficial UTM website.Download the .iso image ofUbuntu 22.04for Humble and Rolling orUbuntu 20.04for Foxy.
Be sure to download the image corresponding to your CPU architecture.In the UTM software:Create a new image and chooseVirtualizeoption.Select the ISO image you have downloaded in theBootISOImagefield.Leave all hardware settings at default (including hardware acceleration disabled).In theSharedDirectorywindow, select a folder that will be used bywebots_ros2to transfer all the Webots assets to the host.
In this example, the selected folder is/Users/username/shared.Leave all the remaining parameters as default.Start the VM.
Note that you can select another shared folder each time you start the VM.During the first launch of the VM, install Ubuntu and choose a username for your account. In this example, the username isubuntu.Once Ubuntu is installed, close the VM, remove the iso image from the CD/DVD field and restart the VM.2 Configure the VMIn this section, ROS 2 is installed in the VM and the shared folder is configured.
The following instructions and commands are all run inside the VM.Open a terminal in the started VM and install the ROS 2 distribution you need by following the instructions inUbuntu (deb packages):Create a folder in the VM to use as a shared folder.
In this example, the shared folder in the VM is/home/ubuntu/shared.mkdir /home/ubuntu/sharedTo mount this folder to the host, execute the following command.
Don’t forget to modify the path to the shared folder, if it is different in your case.sudo mount -t 9p -o trans=virtio share /home/ubuntu/shared -oversion=9p2000.LTo automatically mount this folder to the host when starting the VM, add the following line to/etc/fstab.
Don’t forget to modify the path to the shared folder, if it is different in your case.share     /home/ubuntu/shared     9p      trans=virtio,version=9p2000.L,rw,_netdev,nofail 0       0The environment variableWEBOTS_SHARED_FOLDERmust always be set in order for the package to work properly in the VM.
This variable specifies the location of the shared folder that is used to exchange data between the host machine and the virtual machine (VM) to thewebots_ros2package.
The value to use for this variable should be in the format of<hostsharedfolder>:<VMsharedfolder>, where<hostsharedfolder>is the path to the shared folder on the host machine and<VMsharedfolder>is the path to the same shared folder on the VM.In this example:export WEBOTS_SHARED_FOLDER=/Users/username/shared:/home/ubuntu/sharedYou can add this command line to the~/.bashrcfile to automatically set this environment variable when starting a new terminal.3 Installwebots_ros2You can either installwebots_ros2from the official released package, or install it from the latest up-to-date sources fromGithub.Installwebots_ros2distributed packageInstallwebots_ros2from sourcesRun the following command in the VM terminal.sudo apt-get install ros-jazzy-webots-ros2Install git.sudo apt-get install gitCreate a ROS 2 workspace with itssrcdirectory.mkdir -p ~/ros2_ws/srcSource the ROS 2 environment.source /opt/ros/jazzy/setup.bashRetrieve the sources from Github.cd ~/ros2_wsgit clone --recurse-submodules https://github.com/cyberbotics/webots_ros2.git src/webots_ros2Install the package dependencies.sudo apt install python3-pip python3-rosdep python3-colcon-common-extensionssudo rosdep init && rosdep updaterosdep install --from-paths src --ignore-src --rosdistro jazzyBuild the package usingcolcon.colcon buildSource this workspace.source install/local_setup.bash4 Launch thewebots_ros2_universal_robotexampleAs mentioned in previous sections, the package uses the shared folder to communicate with Webots from the VM to the host.
In order for Webots to be started on the host from the VM’s ROS package, a local TCP simulation server must be run.The server can be downloaded here:local_simulation_server.py.
Specify the Webots installation folder inWEBOTS_HOMEenvironment variable (e.g./Applications/Webots.app) and run the server using the following commands in a new terminal on the host (not in the VM):export WEBOTS_HOME=/Applications/Webots.apppython3 local_simulation_server.pyIn the VM, open a terminal and execute the following commands to start a package:First source the ROS 2 environment, if not done already.source /opt/ros/jazzy/setup.bashIf installed from sources, source your ROS 2 workspace, if not done already.cd ~/ros2_wssource install/local_setup.bashIf not already set in~/.bashrc, setWEBOTS_SHARED_FOLDER(see previous sections for details).
Be sure to change the paths according to the location of your respective directories.export WEBOTS_SHARED_FOLDER=/Users/username/shared:/home/ubuntu/sharedUse the ROS 2 launch command to start demo packages (e.g.webots_ros2_universal_robot).ros2 launch webots_ros2_universal_robot multirobot_launch.pyIf Webots is closed or the ROS 2 process is interrupted, the local server will automatically wait for a new package launch and the shared folder will be cleaned for the next run.

Code Examples:

Language: unknown
mkdir /home/ubuntu/shared

Language: unknown
sudo mount -t 9p -o trans=virtio share /home/ubuntu/shared -oversion=9p2000.L

Language: unknown
share     /home/ubuntu/shared     9p      trans=virtio,version=9p2000.L,rw,_netdev,nofail 0       0

Language: unknown
export WEBOTS_SHARED_FOLDER=/Users/username/shared:/home/ubuntu/shared

Language: unknown
sudo apt-get install ros-jazzy-webots-ros2

Language: unknown
sudo apt-get install git

Language: unknown
mkdir -p ~/ros2_ws/src

Language: unknown
source /opt/ros/jazzy/setup.bash

Language: unknown
cd ~/ros2_wsgit clone --recurse-submodules https://github.com/cyberbotics/webots_ros2.git src/webots_ros2

Language: unknown
sudo apt install python3-pip python3-rosdep python3-colcon-common-extensionssudo rosdep init && rosdep updaterosdep install --from-paths src --ignore-src --rosdistro jazzy

Language: unknown
colcon build

Language: unknown
source install/local_setup.bash

Language: unknown
export WEBOTS_HOME=/Applications/Webots.apppython3 local_simulation_server.py

Language: unknown
source /opt/ros/jazzy/setup.bash

Language: unknown
cd ~/ros2_wssource install/local_setup.bash

Language: unknown
export WEBOTS_SHARED_FOLDER=/Users/username/shared:/home/ubuntu/shared

Language: unknown
ros2 launch webots_ros2_universal_robot multirobot_launch.py
