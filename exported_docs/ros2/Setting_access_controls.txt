Title: Setting access controls
URL: https://docs.ros.org/en/jazzy/Tutorials/Advanced/Security/Access-Controls.html
Section: Installation
--------------------------------------------------------------------------------

Setting access controlsGoal:Limit the topics a node can use.Tutorial level:AdvancedTime:20 minutesContentsBackgroundModifypermissions.xmlSign the policy fileLaunch the nodeUse the templatesBackgroundBefore proceeding ensure you have completed theSetting up securitytutorial.Permissions are quite flexible and can be used to control many behaviors within the ROS graph.For this tutorial, we demonstrate a policy which only allows publishing messages on the defaultchattertopic.
This would prevent, for instance, remapping the topic when launching the listener or using the same security enclaves for another purpose.In order to enforce this policy, we need to update thepermissions.xmlfile and re-sign it before launching the node.
This can be done by modifying the permissions file by hand, or by using XML templates.Modifypermissions.xmlBegin by making a backup of your permissions files, and openpermissions.xmlfor editing:cd~/sros2_demo/demo_keystore/enclaves/talker_listener/talker
mvpermissions.p7spermissions.p7s~
mvpermissions.xmlpermissions.xml~
vipermissions.xmlWe will be modifying the<allow_rule>for<publish>and<subscribe>.
The topics in this XML file use the DDS naming format, not the ROS name.
Find details on mapping topic names between ROS and DDS in theTopic and Service Names design document.Paste the following XML content intopermission.xml, save the file and exit the text editor.
This shows thechatterandrosoutROS topics renamed to the DDSrt/chatterandrt/rosouttopics, respectively:<ddsxmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"xsi:noNamespaceSchemaLocation="http://www.omg.org/spec/DDS-SECURITY/20170901/omg_shared_ca_permissions.xsd"><permissions><grantname="/talker_listener/talker"><subject_name>CN=/talker_listener/talker</subject_name><validity><not_before>2021-06-01T16:57:53</not_before><not_after>2031-05-31T16:57:53</not_after></validity><allow_rule><domains><id>0</id></domains><publish><topics><topic>rt/chatter</topic><topic>rt/rosout</topic><topic>rt/parameter_events</topic><topic>*/talker/*</topic></topics></publish><subscribe><topics><topic>rt/parameter_events</topic><topic>*/talker/*</topic></topics></subscribe></allow_rule><allow_rule><domains><id>0</id></domains><publish><topics><topic>ros_discovery_info</topic></topics></publish><subscribe><topics><topic>ros_discovery_info</topic></topics></subscribe></allow_rule><default>DENY</default></grant></permissions></dds>This policy allows the talker to publish on thechatterand therosouttopics.
It also allows includes publish and subscribe permissions needed for the talker node to manage parameters (a requirement for all nodes).
Discovery permissions remain unchanged from the original template.Sign the policy fileThis next command creates the new S/MIME signed policy filepermissions.p7sfrom the updated XML filepermissions.xml.
The file must be signed with the Permissions CA certificate,which requires access to the Permission CA private key.
If the private key has been protected, additional steps may be required to unlock and use it accoring to your security plan.opensslsmime-sign-text-inpermissions.xml-outpermissions.p7s\--signerpermissions_ca.cert.pem\-inkey~/sros2_demo/demo_keystore/private/permissions_ca.key.pemLaunch the nodeWith the updated permissions in place, we can launch the node successfully using the same command used in prior tutorials:ros2rundemo_nodes_cpptalker--ros-args--enclave/talker_listener/talkerHowever, attempting to remap thechattertopic prevents the node from launching (note that this requires theROS_SECURITY_STRATEGYset toEnforce).ros2rundemo_nodes_cpptalker--ros-args--enclave/talker_listener/talker\--remapchatter:=not_chatterUse the templatesSecurity policies can quickly become confusing, so thesros2utilities add the ability to create policies from templates.
Do this by using thesample policy fileprovided in thesros2repository.
Let’s creates a policy for both thetalkerand thelistenerto only use thechattertopic.Begin by downloading thesros2repository with the sample policy files:gitclonehttps://github.com/ros2/sros2.git/tmp/sros2Then use thecreate_permissionverb while pointing to the sample policy to generate the XML permission files:ros2securitycreate_permissiondemo_keystore\/talker_listener/talker\/tmp/sros2/sros2/test/policies/sample.policy.xml
ros2securitycreate_permissiondemo_keystore\/talker_listener/listener\/tmp/sros2/sros2/test/policies/sample.policy.xmlThese permission files allow nodes to only publish or subscribe to thechattertopic, and enable communications required for parameters.In one terminal with security enabled as in previous security tutorials, run thetalkerdemo program:ros2rundemo_nodes_cpptalker--ros-args-e/talker_listener/talkerIn another terminal do the same with thelistenerprogram:ros2rundemo_nodes_pylistener--ros-args-e/talker_listener/listenerAt this point, yourtalkerandlistenernodes will be communicating securely using explicit access control lists.
However, the following attempt for thelistenernode to subscribe to a topic other thanchatterwill fail:ros2rundemo_nodes_pylistener--ros-args--enclave/talker_listener/listener\--remapchatter:=not_chatter

Code Examples:

Language: unknown
cd~/sros2_demo/demo_keystore/enclaves/talker_listener/talker
mvpermissions.p7spermissions.p7s~
mvpermissions.xmlpermissions.xml~
vipermissions.xml

Language: unknown
<ddsxmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"xsi:noNamespaceSchemaLocation="http://www.omg.org/spec/DDS-SECURITY/20170901/omg_shared_ca_permissions.xsd"><permissions><grantname="/talker_listener/talker"><subject_name>CN=/talker_listener/talker</subject_name><validity><not_before>2021-06-01T16:57:53</not_before><not_after>2031-05-31T16:57:53</not_after></validity><allow_rule><domains><id>0</id></domains><publish><topics><topic>rt/chatter</topic><topic>rt/rosout</topic><topic>rt/parameter_events</topic><topic>*/talker/*</topic></topics></publish><subscribe><topics><topic>rt/parameter_events</topic><topic>*/talker/*</topic></topics></subscribe></allow_rule><allow_rule><domains><id>0</id></domains><publish><topics><topic>ros_discovery_info</topic></topics></publish><subscribe><topics><topic>ros_discovery_info</topic></topics></subscribe></allow_rule><default>DENY</default></grant></permissions></dds>

Language: unknown
opensslsmime-sign-text-inpermissions.xml-outpermissions.p7s\--signerpermissions_ca.cert.pem\-inkey~/sros2_demo/demo_keystore/private/permissions_ca.key.pem

Language: unknown
ros2rundemo_nodes_cpptalker--ros-args--enclave/talker_listener/talker

Language: unknown
ros2rundemo_nodes_cpptalker--ros-args--enclave/talker_listener/talker\--remapchatter:=not_chatter

Language: unknown
gitclonehttps://github.com/ros2/sros2.git/tmp/sros2

Language: unknown
ros2securitycreate_permissiondemo_keystore\/talker_listener/talker\/tmp/sros2/sros2/test/policies/sample.policy.xml
ros2securitycreate_permissiondemo_keystore\/talker_listener/listener\/tmp/sros2/sros2/test/policies/sample.policy.xml

Language: unknown
ros2rundemo_nodes_cpptalker--ros-args-e/talker_listener/talker

Language: unknown
ros2rundemo_nodes_pylistener--ros-args-e/talker_listener/listener

Language: unknown
ros2rundemo_nodes_pylistener--ros-args--enclave/talker_listener/listener\--remapchatter:=not_chatter
