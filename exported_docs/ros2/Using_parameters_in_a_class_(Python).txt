Title: Using parameters in a class (Python)
URL: https://docs.ros.org/en/jazzy/Tutorials/Beginner-Client-Libraries/Using-Parameters-In-A-Class-Python.html
Section: Installation
--------------------------------------------------------------------------------

Using parameters in a class (Python)Goal:Create and run a class with ROS parameters using Python.Tutorial level:BeginnerTime:20 minutesContentsBackgroundPrerequisitesTasks1 Create a package2 Write the Python node3 Build and runSummaryNext stepsBackgroundWhen making your ownnodesyou will sometimes need to add parameters that can be set from the launch file.This tutorial will show you how to create those parameters in a Python class, and how to set them in a launch file.PrerequisitesIn previous tutorials, you learned how tocreate a workspaceandcreate a package.
You have also learned aboutparametersand their function in a ROS 2 system.Tasks1 Create a packageOpen a new terminal andsource your ROS 2 installationso thatros2commands will work.Followthese instructionsto create a new workspace namedros2_ws.Recall that packages should be created in thesrcdirectory, not the root of the workspace.
Navigate intoros2_ws/srcand create a new package:ros2 pkg create --build-type ament_python --license Apache-2.0 python_parameters --dependencies rclpyYour terminal will return a message verifying the creation of your packagepython_parametersand all its necessary files and folders.The--dependenciesargument will automatically add the necessary dependency lines topackage.xmlandCMakeLists.txt.1.1 Updatepackage.xmlBecause you used the--dependenciesoption during package creation, you don’t have to manually add dependencies topackage.xmlorCMakeLists.txt.As always, though, make sure to add the description, maintainer email and name, and license information topackage.xml.<description>Pythonparametertutorial</description><maintaineremail="you@email.com">YourName</maintainer><license>Apache-2.0</license>2 Write the Python nodeInside theros2_ws/src/python_parameters/python_parametersdirectory, create a new file calledpython_parameters_node.pyand paste the following code within:importrclpyimportrclpy.nodeclassMinimalParam(rclpy.node.Node):def__init__(self):super().__init__('minimal_param_node')self.declare_parameter('my_parameter','world')self.timer=self.create_timer(1,self.timer_callback)deftimer_callback(self):my_param=self.get_parameter('my_parameter').get_parameter_value().string_valueself.get_logger().info('Hello%s!'%my_param)my_new_param=rclpy.parameter.Parameter('my_parameter',rclpy.Parameter.Type.STRING,'world')all_new_parameters=[my_new_param]self.set_parameters(all_new_parameters)defmain():rclpy.init()node=MinimalParam()rclpy.spin(node)if__name__=='__main__':main()2.1 Examine the codeTheimportstatements at the top are used to import the package dependencies.The next piece of code creates the class and the constructor.
The lineself.declare_parameter('my_parameter','world')of the constructor creates a parameter with the namemy_parameterand a default value ofworld.
The parameter type is inferred from the default value, so in this case it would be set to a string type.
Next thetimeris initialized with a period of 1, which causes thetimer_callbackfunction to be executed once a second.classMinimalParam(rclpy.node.Node):def__init__(self):super().__init__('minimal_param_node')self.declare_parameter('my_parameter','world')self.timer=self.create_timer(1,self.timer_callback)The first line of ourtimer_callbackfunction gets the parametermy_parameterfrom the node, and stores it inmy_param.
Next theget_loggerfunction ensures the event is logged.
Theset_parametersfunction then sets the parametermy_parameterback to the default string valueworld.
In the case that the user changed the parameter externally, this ensures it is always reset back to the original.deftimer_callback(self):my_param=self.get_parameter('my_parameter').get_parameter_value().string_valueself.get_logger().info('Hello%s!'%my_param)my_new_param=rclpy.parameter.Parameter('my_parameter',rclpy.Parameter.Type.STRING,'world')all_new_parameters=[my_new_param]self.set_parameters(all_new_parameters)Following thetimer_callbackis ourmain.
Here ROS 2 is initialized, an instance of theMinimalParamclass is constructed, andrclpy.spinstarts processing data from the node.defmain():rclpy.init()node=MinimalParam()rclpy.spin(node)if__name__=='__main__':main()2.1.1 (Optional) Add ParameterDescriptorOptionally, you can set a descriptor for the parameter.
Descriptors allow you to specify a text description of the parameter and its constraints, like making it read-only, specifying a range, etc.
For that to work, the__init__code has to be changed to:# ...classMinimalParam(rclpy.node.Node):def__init__(self):super().__init__('minimal_param_node')fromrcl_interfaces.msgimportParameterDescriptormy_parameter_descriptor=ParameterDescriptor(description='This parameter is mine!')self.declare_parameter('my_parameter','world',my_parameter_descriptor)self.timer=self.create_timer(1,self.timer_callback)The rest of the code remains the same.
Once you run the node, you can then runros2paramdescribe/minimal_param_nodemy_parameterto see the type and description.2.2 Add an entry pointOpen thesetup.pyfile.
Again, match themaintainer,maintainer_email,descriptionandlicensefields to yourpackage.xml:maintainer='YourName',maintainer_email='you@email.com',description='Python parameter tutorial',license='Apache-2.0',Add the following line within theconsole_scriptsbrackets of theentry_pointsfield:entry_points={'console_scripts':['minimal_param_node = python_parameters.python_parameters_node:main',],},Don’t forget to save.3 Build and runIt’s good practice to runrosdepin the root of your workspace (ros2_ws) to check for missing dependencies before building:LinuxmacOSWindowsrosdep install -i --from-path src --rosdistro jazzy -yrosdep only runs on Linux, so you can skip ahead to next step.rosdep only runs on Linux, so you can skip ahead to next step.Navigate back to the root of your workspace,ros2_ws, and build your new package:LinuxmacOSWindowscolcon build --packages-select python_parameterscolcon build --packages-select python_parameterscolcon build --merge-install --packages-select python_parametersOpen a new terminal, navigate toros2_ws, and source the setup files:LinuxmacOSWindowssource install/setup.bash. install/setup.bashcall install/setup.batNow run the node:ros2 run python_parameters minimal_param_nodeThe terminal should return the following message every second:[INFO] [parameter_node]: Hello world!Now you can see the default value of your parameter, but you want to be able to set it yourself.
There are two ways to accomplish this.3.1 Change via the consoleThis part will use the knowledge you have gained from thetutoral about parametersand apply it to the node you have just created.Make sure the node is running:ros2 run python_parameters minimal_param_nodeOpen another terminal, source the setup files from insideros2_wsagain, and enter the following line:ros2 param listThere you will see the custom parametermy_parameter.
To change it, simply run the following line in the console:ros2 param set /minimal_param_node my_parameter earthYou know it went well if you get the outputSetparametersuccessful.
If you look at the other terminal, you should see the output change to[INFO][minimal_param_node]:Helloearth!Since the node afterwards set the parameter back toworld, further outputs show[INFO][minimal_param_node]:Helloworld!3.2 Change via a launch fileYou can also set parameters in a launch file, but first you will need to add a launch directory.
Inside theros2_ws/src/python_parameters/directory, create a new directory calledlaunch.
In there, create a new file calledpython_parameters_launch.pyfromlaunchimportLaunchDescriptionfromlaunch_ros.actionsimportNodedefgenerate_launch_description():returnLaunchDescription([Node(package='python_parameters',executable='minimal_param_node',name='custom_minimal_param_node',output='screen',emulate_tty=True,parameters=[{'my_parameter':'earth'}])])Here you can see that we setmy_parametertoearthwhen we launch our nodeparameter_node.
By adding the two lines below, we ensure our output is printed in our console.output="screen",emulate_tty=True,Now open thesetup.pyfile.
Add theimportstatements to the top of the file, and the other new statement to thedata_filesparameter to include all launch files:importosfromglobimportglob# ...setup(# ...data_files=[# ...(os.path.join('share',package_name),glob('launch/*launch.[pxy][yma]*')),])Open a console and navigate to the root of your workspace,ros2_ws, and build your new package:LinuxmacOSWindowscolcon build --packages-select python_parameterscolcon build --packages-select python_parameterscolcon build --merge-install --packages-select python_parametersThen source the setup files in a new terminal:LinuxmacOSWindowssource install/setup.bash. install/setup.bashcall install/setup.batNow run the node using the launch file we have just created:ros2 launch python_parameters python_parameters_launch.pyThe terminal should return the following message the first time:[INFO] [custom_minimal_param_node]: Hello earth!Further outputs should show[INFO][minimal_param_node]:Helloworld!every second.SummaryYou created a node with a custom parameter that can be set either from a launch file or the command line.
You added the dependencies, executables, and a launch file to the package configuration files so that you could build and run them, and see the parameter in action.Next stepsNow that you have some packages and ROS 2 systems of your own, thenext tutorialwill show you how to examine issues in your environment and systems in case you have problems.

Code Examples:

Language: unknown
ros2 pkg create --build-type ament_python --license Apache-2.0 python_parameters --dependencies rclpy

Language: unknown
<description>Pythonparametertutorial</description><maintaineremail="you@email.com">YourName</maintainer><license>Apache-2.0</license>

Language: unknown
importrclpyimportrclpy.nodeclassMinimalParam(rclpy.node.Node):def__init__(self):super().__init__('minimal_param_node')self.declare_parameter('my_parameter','world')self.timer=self.create_timer(1,self.timer_callback)deftimer_callback(self):my_param=self.get_parameter('my_parameter').get_parameter_value().string_valueself.get_logger().info('Hello%s!'%my_param)my_new_param=rclpy.parameter.Parameter('my_parameter',rclpy.Parameter.Type.STRING,'world')all_new_parameters=[my_new_param]self.set_parameters(all_new_parameters)defmain():rclpy.init()node=MinimalParam()rclpy.spin(node)if__name__=='__main__':main()

Language: unknown
classMinimalParam(rclpy.node.Node):def__init__(self):super().__init__('minimal_param_node')self.declare_parameter('my_parameter','world')self.timer=self.create_timer(1,self.timer_callback)

Language: unknown
deftimer_callback(self):my_param=self.get_parameter('my_parameter').get_parameter_value().string_valueself.get_logger().info('Hello%s!'%my_param)my_new_param=rclpy.parameter.Parameter('my_parameter',rclpy.Parameter.Type.STRING,'world')all_new_parameters=[my_new_param]self.set_parameters(all_new_parameters)

Language: unknown
defmain():rclpy.init()node=MinimalParam()rclpy.spin(node)if__name__=='__main__':main()

Language: unknown
# ...classMinimalParam(rclpy.node.Node):def__init__(self):super().__init__('minimal_param_node')fromrcl_interfaces.msgimportParameterDescriptormy_parameter_descriptor=ParameterDescriptor(description='This parameter is mine!')self.declare_parameter('my_parameter','world',my_parameter_descriptor)self.timer=self.create_timer(1,self.timer_callback)

Language: unknown
maintainer='YourName',maintainer_email='you@email.com',description='Python parameter tutorial',license='Apache-2.0',

Language: unknown
entry_points={'console_scripts':['minimal_param_node = python_parameters.python_parameters_node:main',],},

Language: unknown
rosdep install -i --from-path src --rosdistro jazzy -y

Language: unknown
colcon build --packages-select python_parameters

Language: unknown
colcon build --packages-select python_parameters

Language: unknown
colcon build --merge-install --packages-select python_parameters

Language: unknown
source install/setup.bash

Language: unknown
. install/setup.bash

Language: unknown
call install/setup.bat

Language: unknown
ros2 run python_parameters minimal_param_node

Language: unknown
[INFO] [parameter_node]: Hello world!

Language: unknown
ros2 run python_parameters minimal_param_node

Language: unknown
ros2 param list

Language: unknown
ros2 param set /minimal_param_node my_parameter earth

Language: unknown
fromlaunchimportLaunchDescriptionfromlaunch_ros.actionsimportNodedefgenerate_launch_description():returnLaunchDescription([Node(package='python_parameters',executable='minimal_param_node',name='custom_minimal_param_node',output='screen',emulate_tty=True,parameters=[{'my_parameter':'earth'}])])

Language: unknown
output="screen",emulate_tty=True,

Language: unknown
importosfromglobimportglob# ...setup(# ...data_files=[# ...(os.path.join('share',package_name),glob('launch/*launch.[pxy][yma]*')),])

Language: unknown
colcon build --packages-select python_parameters

Language: unknown
colcon build --packages-select python_parameters

Language: unknown
colcon build --merge-install --packages-select python_parameters

Language: unknown
source install/setup.bash

Language: unknown
. install/setup.bash

Language: unknown
call install/setup.bat

Language: unknown
ros2 launch python_parameters python_parameters_launch.py

Language: unknown
[INFO] [custom_minimal_param_node]: Hello earth!
