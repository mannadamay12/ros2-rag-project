Title: Using time (C++)
URL: https://docs.ros.org/en/jazzy/Tutorials/Intermediate/Tf2/Learning-About-Tf2-And-Time-Cpp.html
Section: Installation
--------------------------------------------------------------------------------

Using time (C++)Goal:Learn how to get a transform at a specific time and wait for a transform to be available on the tf2 tree usinglookupTransform()function.Tutorial level:IntermediateTime:10 minutesContentsBackgroundTasks1 Update the listener node2 Fix the listener node3 Check the resultsSummaryBackgroundIn previous tutorials, we recreated the turtle demo by writing atf2 broadcasterand atf2 listener.
We also learned how toadd a new frame to the transformation treeand learned how tf2 keeps track of a tree of coordinate frames.
This tree changes over time, and tf2 stores a time snapshot for every transform (for up to 10 seconds by default).
Until now we used thelookupTransform()function to get access to the latest available transforms in that tf2 tree, without knowing at what time that transform was recorded.
This tutorial will teach you how to get a transform at a specific time.Tasks1 Update the listener nodeLet’s go back to where we ended in theadding a frame tutorial.
Go to thelearning_tf2_cpppackage.
Openturtle_tf2_listener.cppand take a look at thelookupTransform()call:try{t=tf_buffer_->lookupTransform(toFrameRel,fromFrameRel,tf2::TimePointZero);}catch(consttf2::TransformException&ex){You can see that we specified a time equal to 0 by callingtf2::TimePointZero.NoteThetf2package has it’s own time typetf2::TimePoint, which is different fromrclcpp::Time.
Many APIs in the packagetf2_rosautomatically convert betweenrclcpp::Timeandtf2::TimePoint.rclcpp::Time(0,0,this->get_clock()->get_clock_type())could have been used here, but it would have been converted totf2::TimePointZeroanyways.For tf2, time 0 means “the latest available” transform in the buffer.
Now, change this line to get the transform at the current time,this->get_clock()->now():rclcpp::Timenow=this->get_clock()->now();try{t=tf_buffer_->lookupTransform(toFrameRel,fromFrameRel,now);}catch(consttf2::TransformException&ex){Now build the package and try to run the launch file.ros2 launch learning_tf2_cpp turtle_tf2_demo_launch.pyYou will notice that it fails and outputs something similar to this:[INFO] [1629873136.345688064] [listener]: Could not transform turtle2 to turtle1: Lookup wouldrequire extrapolation into the future.  Requested time 1629873136.345539 but the latest datais at time 1629873136.338804, when looking up transform from frame [turtle1] to frame [turtle2]It tells you that the frame does not exist or that the data is in the future.To understand why is this happening we need to understand how buffers work.
Firstly, each listener has a buffer where it stores all the coordinate transforms coming from the different tf2 broadcasters.
Secondly, when a broadcaster sends out a transform, it takes some time before that transform gets into the buffer (usually a couple of milliseconds).
As a result, when you request a frame transform at time “now”, you should wait a few milliseconds for that information to arrive.2 Fix the listener nodetf2 provides a nice tool that will wait until a transform becomes available.
You use this by adding a timeout parameter tolookupTransform().
To fix this, edit your code as shown below (add the last timeout parameter):rclcpp::Timenow=this->get_clock()->now();try{t=tf_buffer_->lookupTransform(toFrameRel,fromFrameRel,now,50ms);}catch(consttf2::TransformException&ex){ThelookupTransform()can take four arguments, where the last one is an optional timeout.
It will block for up to that duration waiting for it to timeout.3 Check the resultsYou can now build the package and run the launch file.ros2 launch learning_tf2_cpp turtle_tf2_demo_launch.pyYou should notice thatlookupTransform()will actually block until the transform between the two turtles becomes available (this will usually take a few milliseconds).
Once the timeout has been reached (fifty milliseconds in this case), an exception will be raised only if the transform is still not available.SummaryIn this tutorial, you learned how to acquire a transform at a specific timestamp and how to wait for a transform to be available on the tf2 tree when using thelookupTransform()function.

Code Examples:

Language: unknown
try{t=tf_buffer_->lookupTransform(toFrameRel,fromFrameRel,tf2::TimePointZero);}catch(consttf2::TransformException&ex){

Language: unknown
rclcpp::Timenow=this->get_clock()->now();try{t=tf_buffer_->lookupTransform(toFrameRel,fromFrameRel,now);}catch(consttf2::TransformException&ex){

Language: unknown
ros2 launch learning_tf2_cpp turtle_tf2_demo_launch.py

Language: unknown
[INFO] [1629873136.345688064] [listener]: Could not transform turtle2 to turtle1: Lookup wouldrequire extrapolation into the future.  Requested time 1629873136.345539 but the latest datais at time 1629873136.338804, when looking up transform from frame [turtle1] to frame [turtle2]

Language: unknown
rclcpp::Timenow=this->get_clock()->now();try{t=tf_buffer_->lookupTransform(toFrameRel,fromFrameRel,now,50ms);}catch(consttf2::TransformException&ex){

Language: unknown
ros2 launch learning_tf2_cpp turtle_tf2_demo_launch.py
